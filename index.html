<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Activity Timesheet</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const CATEGORIES = [
            'IT CRM Activities',
            'IT Online Client Acquisition',
            'IT Onsite Client Acquisition',
            'IT Tenders',
            'INT CRM Activities',
            'INT Online Client Acquisition',
            'INT Onsite Client Acquisition',
            'INT Tenders',
            'Proposal Drafting',
            'Technical Support',
            'IT Renewal Activities',
            'INT Renewal Activities',
            'Conferences',
            'Personal Management',
            'Sales & Internal Meetings',
            'Distributor Meetings',
            'VarChat BI',
            'Competitor Analysis',
            'Personal Training',
            'PTO',
            'Weekend'
        ];

        const HOURS = ['09:00', '10:00', '11:00', '12:00', '14:00', '15:00', '16:00', '17:00'];
        const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

        const ChevronDown = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        const ChevronUp = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="18 15 12 9 6 15"></polyline>
            </svg>
        );

        const Download = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Upload = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Calendar = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const BarChart3 = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="20" x2="12" y2="10"></line>
                <line x1="18" y1="20" x2="18" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="16"></line>
            </svg>
        );

        const Trash2 = () => (
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        function TimesheetTracker() {
            const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
            const [currentView, setCurrentView] = useState('daily');
            const [saveStatus, setSaveStatus] = useState('');
            const [collapsedDays, setCollapsedDays] = useState({});
            const [timesheet, setTimesheet] = useState(() => {
                const saved = localStorage.getItem('timesheet-local');
                if (saved) return JSON.parse(saved);
                
                const initial = {};
                MONTHS.forEach((_, monthIdx) => {
                    initial[monthIdx] = {};
                    for (let day = 1; day <= 31; day++) {
                        initial[monthIdx][day] = {};
                        HOURS.forEach(hour => { initial[monthIdx][day][hour] = ''; });
                    }
                });
                return initial;
            });

            useEffect(() => {
                localStorage.setItem('timesheet-local', JSON.stringify(timesheet));
            }, [timesheet]);

            useEffect(() => {
                autoCollapseDays();
            }, [currentMonth, timesheet]);

            const isDayFilled = (monthIdx, day) => {
                const dayData = timesheet[monthIdx]?.[day];
                if (!dayData) return false;
                // Changed to .every so it only collapses when ALL hours are completed
                return HOURS.every(hour => dayData[hour] && dayData[hour].trim() !== '');
            };

            const autoCollapseDays = () => {
                const newCollapsed = {};
                const daysInMonth = getDaysInMonth(currentMonth);
                for (let day = 1; day <= daysInMonth; day++) {
                    if (isDayFilled(currentMonth, day)) {
                        newCollapsed[day] = true;
                    }
                }
                setCollapsedDays(newCollapsed);
            };

            const toggleDayCollapse = (day) => {
                setCollapsedDays(prev => ({ ...prev, [day]: !prev[day] }));
            };

            const updateActivity = (month, day, hour, activity) => {
                setTimesheet(prev => ({
                    ...prev,
                    [month]: {
                        ...prev[month],
                        [day]: { ...prev[month][day], [hour]: activity }
                    }
                }));
            };

            const bulkUpdateDay = (month, day, activity) => {
                if (!activity) return;
                setTimesheet(prev => {
                    const updatedDay = {};
                    HOURS.forEach(hour => { updatedDay[hour] = activity; });
                    return {
                        ...prev,
                        [month]: { ...prev[month], [day]: updatedDay }
                    };
                });
            };

            const clearDay = (month, day) => {
                if (window.confirm(`Are you sure you want to clear all entries for Day ${day}?`)) {
                    setTimesheet(prev => {
                        const emptyDay = {};
                        HOURS.forEach(hour => { emptyDay[hour] = ''; });
                        return {
                            ...prev,
                            [month]: { ...prev[month], [day]: emptyDay }
                        };
                    });
                }
            };

            const getDaysInMonth = (monthIdx) => {
                return new Date(new Date().getFullYear(), monthIdx + 1, 0).getDate();
            };

            const calculateMonthlyTotals = (monthIdx) => {
                const totals = {};
                CATEGORIES.forEach(cat => totals[cat] = 0);
                const daysInMonth = getDaysInMonth(monthIdx);
                for (let day = 1; day <= daysInMonth; day++) {
                    HOURS.forEach(hour => {
                        const activity = timesheet[monthIdx]?.[day]?.[hour];
                        if (activity && CATEGORIES.includes(activity)) {
                            totals[activity] = (totals[activity] || 0) + 1;
                        }
                    });
                }
                return totals;
            };

            const exportToJSON = () => {
                const dataStr = JSON.stringify(timesheet, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `timesheet_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                window.URL.revokeObjectURL(url);
            };

            const importFromJSON = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        setTimesheet(JSON.parse(e.target.result));
                        setSaveStatus('✓ Data imported successfully');
                        setTimeout(() => setSaveStatus(''), 2000);
                    } catch (error) {
                        setSaveStatus('✗ Import failed');
                        setTimeout(() => setSaveStatus(''), 3000);
                    }
                };
                reader.readAsText(file);
            };

            const exportMonthlyCSV = () => {
                const totals = calculateMonthlyTotals(currentMonth);
                const monthName = MONTHS[currentMonth];
                let csv = `Activity,Hours,%\n`;
                const sorted = Object.entries(totals).filter(([_, h]) => h > 0).sort((a,b) => b[1]-a[1]);
                const total = sorted.reduce((s, [_, h]) => s + h, 0);
                sorted.forEach(([cat, h]) => csv += `${cat},${h},${((h/total)*100).toFixed(1)}%\n`);
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `report_${monthName}.csv`; a.click();
            };

            const renderDailyView = () => {
                const daysInMonth = getDaysInMonth(currentMonth);
                const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
                const sortedDays = days.sort((a, b) => {
                    const aF = isDayFilled(currentMonth, a);
                    const bF = isDayFilled(currentMonth, b);
                    return aF === bF ? a - b : (aF ? 1 : -1);
                });

                return (
                    <div className="space-y-3">
                        {sortedDays.map(day => {
                            const filled = isDayFilled(currentMonth, day);
                            const collapsed = collapsedDays[day];
                            return (
                                <div key={day} className={`rounded-lg shadow transition-all ${filled ? 'bg-gray-100' : 'bg-white'}`}>
                                    <div 
                                        className="flex flex-col md:flex-row md:items-center justify-between p-4 cursor-pointer hover:bg-gray-50 gap-4"
                                        onClick={() => filled && toggleDayCollapse(day)}
                                    >
                                        <h3 className={`font-semibold text-lg ${filled ? 'text-gray-600' : 'text-gray-800'}`}>
                                            Day {day} - {MONTHS[currentMonth]}
                                            {filled && <span className="ml-2 text-sm text-green-600 font-bold">✓ Complete</span>}
                                        </h3>

                                        <div className="flex items-center gap-3" onClick={(e) => e.stopPropagation()}>
                                            {!filled && (
                                                <div className="flex items-center gap-2">
                                                    <span className="text-xs font-bold text-gray-400 uppercase">Bulk Fill:</span>
                                                    <select
                                                        onChange={(e) => bulkUpdateDay(currentMonth, day, e.target.value)}
                                                        value=""
                                                        className="text-xs border border-gray-300 rounded px-2 py-1 bg-white"
                                                    >
                                                        <option value="">-- Select --</option>
                                                        {CATEGORIES.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                                    </select>
                                                </div>
                                            )}
                                            
                                            <button 
                                                onClick={() => clearDay(currentMonth, day)}
                                                className="flex items-center gap-1 px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded border border-red-200 transition-colors"
                                                title="Clear all hours for this day"
                                            >
                                                <Trash2 /> Clear
                                            </button>

                                            {filled && (
                                                <button className="text-gray-500 hover:text-gray-700">
                                                    {collapsed ? <ChevronDown /> : <ChevronUp />}
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {(!filled || !collapsed) && (
                                        <div className="px-4 pb-4 grid grid-cols-1 gap-2 border-t pt-4">
                                            {HOURS.map(hour => (
                                                <div key={hour} className="flex items-center gap-3">
                                                    <span className="font-medium text-sm text-gray-600 w-16">{hour}</span>
                                                    <select
                                                        value={timesheet[currentMonth]?.[day]?.[hour] || ''}
                                                        onChange={(e) => updateActivity(currentMonth, day, hour, e.target.value)}
                                                        className="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500"
                                                    >
                                                        <option value="">-- Select Activity --</option>
                                                        {CATEGORIES.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                                    </select>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                );
            };

            const renderMonthlyOverview = () => {
                const totals = calculateMonthlyTotals(currentMonth);
                const sortedTotals = Object.entries(totals).filter(([_, h]) => h > 0).sort((a, b) => b[1] - a[1]);
                const totalHours = sortedTotals.reduce((sum, [_, h]) => sum + h, 0);
                const maxHours = Math.max(...sortedTotals.map(([_, h]) => h), 1);

                return (
                    <div className="space-y-6">
                        <div className="bg-white rounded-lg shadow p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-semibold text-xl text-gray-800">Monthly Summary - {MONTHS[currentMonth]}</h3>
                                <button onClick={exportMonthlyCSV} className="flex items-center gap-2 px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors">
                                    <Download /> Export CSV
                                </button>
                            </div>
                            <div className="mb-4 p-4 bg-blue-50 rounded-lg">
                                <p className="text-2xl font-bold text-blue-600">{totalHours} Total Hours</p>
                            </div>
                            <div className="space-y-3">
                                {sortedTotals.map(([category, hours]) => (
                                    <div key={category} className="space-y-1">
                                        <div className="flex justify-between items-center text-sm">
                                            <span className="font-medium text-gray-700">{category}</span>
                                            <span className="text-gray-600">{hours}h ({((hours / totalHours) * 100).toFixed(1)}%)</span>
                                        </div>
                                        <div className="w-full bg-gray-200 rounded-full h-3">
                                            <div className="bg-blue-500 h-3 rounded-full transition-all" style={{ width: `${(hours / maxHours) * 100}%` }} />
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-100 p-6">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                <h1 className="text-3xl font-bold text-gray-800">Sales Activity Timesheet</h1>
                                {saveStatus && <div className="px-4 py-2 bg-green-100 text-green-700 rounded-lg text-sm font-medium">{saveStatus}</div>}
                                <div className="flex gap-2">
                                    <button onClick={exportToJSON} className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm">
                                        <Download /> Backup
                                    </button>
                                    <label className="flex items-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors cursor-pointer text-sm">
                                        <Upload /> Restore <input type="file" accept=".json" onChange={importFromJSON} className="hidden" />
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6 flex flex-col md:flex-row gap-4">
                            <div className="flex-1">
                                <label className="block text-sm font-medium text-gray-700 mb-2">Month</label>
                                <select value={currentMonth} onChange={(e) => setCurrentMonth(Number(e.target.value))} className="w-full px-4 py-2 border rounded-lg">
                                    {MONTHS.map((m, idx) => <option key={m} value={idx}>{m}</option>)}
                                </select>
                            </div>
                            <div className="flex-1">
                                <label className="block text-sm font-medium text-gray-700 mb-2">View</label>
                                <div className="flex gap-2">
                                    <button onClick={() => setCurrentView('daily')} className={`flex-1 py-2 rounded-lg ${currentView === 'daily' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}>Daily</button>
                                    <button onClick={() => setCurrentView('monthly')} className={`flex-1 py-2 rounded-lg ${currentView === 'monthly' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}>Monthly</button>
                                </div>
                            </div>
                        </div>

                        {currentView === 'daily' ? renderDailyView() : renderMonthlyOverview()}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TimesheetTracker />, document.getElementById('root'));
    </script>
</body>

</html>
